<!DOCTYPE html>
<html>
<head>
  <title>Katnallu â€“ Create Event</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family:Arial; background:#ffe6d5; display:flex; justify-content:center; padding:20px }
    .card { background:#fff; max-width:520px; width:100%; padding:24px; border-radius:22px }
    input { width:100%; padding:14px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd }
    button { width:100%; padding:16px; border:none; border-radius:14px; background:#1fa74a; color:#fff }
    .gift { display:flex; gap:10px }
  </style>
</head>

<body>
<div class="card">
  <h2>ğŸ‰ Create Celebration</h2>

  <input id="occasion" placeholder="Occasion name" />
  <input id="date" type="date" />
  <input id="upi" placeholder="UPI ID" />
  <input type="file" id="photo" />

  <h3>ğŸ Gifts</h3>
  <div id="gifts">
    <div class="gift">
      <input placeholder="Gift name">
      <input type="number" placeholder="Amount">
    </div>
  </div>

  <button onclick="addGift()">+ Add Gift</button><br><br>
  <button onclick="createEvent()">Save & Generate Link ğŸ”—</button>
</div>

<script>
const supabase = supabaseJs.createClient(
  "https://jdzerwfsrctemjwxqru.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
);

function addGift(){
  gifts.insertAdjacentHTML("beforeend", `
    <div class="gift">
      <input placeholder="Gift name">
      <input type="number" placeholder="Amount">
    </div>
  `);
}

async function createEvent(){
  const file = photo.files[0];
  const filePath = `event-${Date.now()}.jpg`;

  await supabase.storage
    .from("event-photos")
    .upload(filePath, file);

  const photoUrl = supabase.storage
    .from("event-photos")
    .getPublicUrl(filePath).data.publicUrl;

  const { data: event } = await supabase
    .from("events")
    .insert([{
      occasion: occasion.value,
      event_date: date.value,
      upi: upi.value,
      photo_url: photoUrl
    }])
    .select()
    .single();

  document.querySelectorAll(".gift").forEach(async g => {
    await supabase.from("gifts").insert([{
      event_id: event.id,
      name: g.children[0].value,
      amount: g.children[1].value
    }]);
  });

  window.location.href = `contribute.html?event_id=${event.id}`;
}
</script>
</body>
</html>
